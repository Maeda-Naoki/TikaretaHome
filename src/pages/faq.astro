---
import Breadcrumbs from '@components/common/Breadcrumbs.astro';
import FAQItem from '@components/faq/FAQItem.astro';
import { faqByCategory } from '@data/faq';
import Layout from '@layouts/Layout.astro';
import { useTranslations } from '@utils/i18n';
import { createBreadcrumbListLD, createFAQPageLD } from '@utils/seo';
import { type FAQCategory, getFAQItemData } from '@utils/translationTypes';

const t = useTranslations(Astro.currentLocale);

// Create FAQ JSON-LD
const allFAQs = Object.values(faqByCategory).flat();
const faqJsonLd = createFAQPageLD(
  allFAQs.map((item) => {
    const categoryKey = item.category as FAQCategory;
    const parts = item.questionKey.split('.');
    const itemKey = parts[parts.length - 2];
    const itemData = getFAQItemData(t, categoryKey, itemKey);
    return {
      question: itemData?.question || '',
      answer: itemData?.answer || '',
    };
  })
);

const breadcrumbJsonLd = createBreadcrumbListLD([
  { name: t.nav.home, url: 'https://tikareta.com/' },
  { name: t.nav.faq, url: 'https://tikareta.com/faq' },
]);
---

<Layout
  title={t.pages.faq.title}
  description={t.pages.faq.description}
  jsonLd={[faqJsonLd, breadcrumbJsonLd]}
>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <Breadcrumbs items={[{ name: t.nav.faq, url: '/faq' }]} />

    <h1 class="text-4xl font-display font-bold text-warm-gray-900 mb-12 text-center fade-in-up">
      {t.faq.title}
    </h1>

    {Object.entries(faqByCategory).map(([category, items]) => (
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-warm-gray-900 mb-6 fade-in-up">
          {t.faq.categories[category as keyof typeof t.faq.categories]}
        </h2>
        <div class="space-y-4">
          {items.map((item) => {
            const parts = item.questionKey.split('.');
            const itemKey = parts[parts.length - 2];
            const itemData = getFAQItemData(t, category as FAQCategory, itemKey);
            return (
              <FAQItem
                id={item.id}
                question={itemData?.question || ''}
                answer={itemData?.answer || ''}
              />
            );
          })}
        </div>
      </section>
    ))}
  </div>
</Layout>
